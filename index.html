<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ProGlove Bowl Tracker</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Excel Export Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"></script>

  <!-- Styles -->
  <style>
    :root {
      --bg-dark:#0f1724;--card:#273041;--card-light:#37475a;
      --text:#f3f4f6;--muted:#a0aec0;--border:#4a5568;
      --accent-pink:#ff6e96;--accent-green:#00e0b3;
      --accent-red:#ff5252;--accent-indigo:#7986cb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter',sans-serif;background:var(--bg-dark);color:var(--text);}
    .container{max-width:980px;margin:0 auto;padding:18px;}
    .app-header{background:var(--card);border-radius:12px;padding:20px;margin-bottom:16px;border-bottom:4px solid var(--accent-pink);position:relative;}
    .header-title{color:var(--accent-pink);font-weight:800;font-size:20px;}
    .header-sub{color:var(--muted);margin-top:6px;}
    #systemStatus{position:absolute;right:16px;top:16px;padding:6px 10px;border-radius:8px;background:#6b7280;color:#fff;font-weight:700;font-size:13px;}
    .app-card{background:var(--card);border-radius:10px;padding:16px;margin-bottom:14px;border:1px solid var(--border);}
    .section-title{font-weight:600;color:var(--text);font-size:16px;border-bottom:1px solid var(--border);padding-bottom:8px;margin-bottom:12px;}
    .flex-row{display:flex;gap:10px;flex-wrap:wrap;}
    .flex-1{flex:1;}
    .mode-button{flex:1;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700;color:#fff;background:var(--card-light);}
    .btn-pill{border-radius:999px;padding:10px 18px;}
    .btn-green{background:var(--accent-green);color:#05201a;}
    .btn-red{background:var(--accent-red);color:#391010;}
    .input,select,textarea{width:100%;padding:10px;border-radius:8px;background:transparent;border:1px solid var(--border);color:var(--text);font-size:14px;}
    .scanner-input{font-size:16px;text-align:center;border-width:3px;}
    .metrics-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:12px;}
    .metric{background:var(--card-light);padding:10px;border-radius:8px;text-align:center;}
    .metric .value{font-size:20px;font-weight:800;}
    .metric .label{color:var(--muted);font-size:12px;}
    .message-container{position:fixed;top:10px;left:50%;transform:translateX(-50%);z-index:9999;pointer-events:none;max-width:600px;}
    .footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center;}
    @media(max-width:820px){.metrics-grid{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>

<body>
  <div class="message-container" id="messageContainer"></div>
  <div class="container">
    <header class="app-header">
      <div class="header-title">ðŸ§¤ PROGLOVE BOWL TRACKER</div>
      <div class="header-sub">Real-time Prep & Return Synchronization</div>
      <div id="systemStatus">Initializing...</div>
    </header>

    <div class="app-card">
      <div class="section-title">Select Mode</div>
      <div class="flex-row">
        <button class="mode-button" onclick="setMode('kitchen')">Kitchen</button>
        <button class="mode-button" onclick="setMode('return')">Return</button>
      </div>
    </div>

    <div class="app-card">
      <div class="section-title">Select User</div>
      <select id="userSelect" onchange="selectUser()"></select>
    </div>

    <div class="app-card" id="dishWrapper" style="display:none;">
      <div class="section-title">Select Dish</div>
      <select id="dishSelect" onchange="selectDishLetter()"></select>
    </div>

    <div class="app-card">
      <div class="section-title">Scanning Controls</div>
      <div class="flex-row">
        <button id="startBtn" class="btn-green btn-pill" onclick="startScanning()">Start</button>
        <button id="stopBtn" class="btn-red btn-pill" onclick="stopScanning()">Stop</button>
      </div>
      <input id="scanInput" class="scanner-input input" placeholder="Select user and press START..." disabled />
      <div id="responseTimeValue" style="margin-top:8px;font-size:13px;color:var(--muted)"></div>
    </div>

    <div class="app-card">
      <div class="section-title">Metrics</div>
      <div class="metrics-grid">
        <div class="metric"><div class="value" id="activeCount">0</div><div class="label">Active Bowls</div></div>
        <div class="metric"><div class="value" id="preparedTodayCount">0</div><div class="label">Prepared Today</div></div>
        <div class="metric"><div class="value" id="returnedCount">0</div><div class="label">Returned Today</div></div>
        <div class="metric"><div class="value" id="myScansCount">0</div><div class="label">My Scans</div></div>
      </div>
    </div>

    <div class="app-card">
      <div class="section-title">Overnight Kitchen Report (10PMâ€“10PM)</div>
      <table class="data-table">
        <thead><tr><th>Dish</th><th>User</th><th>Count</th></tr></thead>
        <tbody id="livePrepReportBody"></tbody>
      </table>
    </div>

    <div class="app-card">
      <div class="section-title">Cloud Sync Info</div>
      <div id="lastSyncInfo" class="small-note"></div>
    </div>

    <div class="footer">Â© 2025 Berlin Kitchen</div>
  </div>

  <!-- Main app logic -->
  <script src="app-logic.js"></script>
</body>
</html>
