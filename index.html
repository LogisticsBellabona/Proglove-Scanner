<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ProGlove Bowl Tracking System</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<!-- Excel Libraries -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<!-- Custom Styles & Base -->
<style>
  body { 
    font-family: 'Inter', sans-serif; 
    background-color: #0f172a; /* Corresponds to Tailwind's slate-900 */
    color: #f1f5f9; /* slate-100 */
    -webkit-font-smoothing: antialiased;
  }
  /* Custom animation for messages */
  @keyframes fade-in-down {
      0% {
          opacity: 0;
          transform: translateY(-10px);
      }
      100% {
          opacity: 1;
          transform: translateY(0);
      }
  }
  .animate-fade-in-down {
      animation: fade-in-down 0.3s ease-out forwards;
  }
</style>
</head>
<body>
  <div id="messageContainer" class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-full max-w-md px-4 space-y-2"></div>
  <div class="container max-w-4xl mx-auto p-4">
    <header class="bg-slate-800 rounded-xl p-5 mb-4 relative border-b-4 border-pink-500 shadow-lg">
      <h1 class="text-xl font-extrabold text-pink-500 tracking-wider">üß§ PROGLOVE BOWL TRACKING</h1>
      <p class="text-slate-400 mt-1">Real-time Prep & Return Synchronization</p>
      <div id="systemStatus" class="absolute right-4 top-4 px-3 py-1 rounded-full text-xs font-bold text-white bg-gray-600">
        INITIALIZING...
      </div>
    </header>

    <section class="bg-slate-800 border border-slate-700 rounded-lg p-4 mb-4 shadow-md">
      <h2 class="text-base font-semibold text-slate-200 border-b border-slate-700 pb-2 mb-4">1. Select Operation Mode</h2>
      <div class="flex gap-4">
        <button id="kitchenModeBtn" class="flex-1 p-3 rounded-lg font-bold text-white transition-all duration-200 bg-slate-700 hover:bg-slate-600">
          üç≥ KITCHEN PREP
        </button>
        <button id="returnModeBtn" class="flex-1 p-3 rounded-lg font-bold text-white transition-all duration-200 bg-slate-700 hover:bg-slate-600">
          üîÑ RETURN SCAN
        </button>
      </div>
      <p class="text-sm text-slate-400 mt-3">Status: <span id="modeStatus">Please select a mode</span></p>
    </section>

    <section class="bg-slate-800 border border-slate-700 rounded-lg p-4 mb-4 shadow-md">
      <h2 class="text-base font-semibold text-slate-200 border-b border-slate-700 pb-2 mb-4">2. Select User & Dish</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label for="userSelect" class="block text-sm font-medium text-slate-300 mb-1">User</label>
          <select id="userSelect" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 focus:ring-2 focus:ring-pink-500 focus:outline-none">
            <option value="">-- Select Mode First --</option>
          </select>
        </div>
        <div id="dishSelectorContainer" style="display: none;">
          <label for="dishSelect" class="block text-sm font-medium text-slate-300 mb-1">Dish Letter</label>
          <select id="dishSelect" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 focus:ring-2 focus:ring-pink-500 focus:outline-none">
            <option value="">-- Select Dish --</option>
          </select>
        </div>
      </div>
    </section>

    <section class="bg-slate-800 border border-slate-700 rounded-lg p-4 mb-4 shadow-md">
      <h2 class="text-base font-semibold text-slate-200 border-b border-slate-700 pb-2 mb-4">3. Scan Bowls</h2>
      <div class="flex items-center gap-4">
        <button id="startScanBtn" class="flex-1 p-3 rounded-lg font-bold text-white bg-emerald-600 hover:bg-emerald-500 disabled:bg-slate-600 disabled:cursor-not-allowed">
          ‚ñ∂Ô∏è START SCAN
        </button>
        <button id="stopScanBtn" class="flex-1 p-3 rounded-lg font-bold text-white bg-red-600 hover:bg-red-500 disabled:bg-slate-600 disabled:cursor-not-allowed">
          ‚èπÔ∏è STOP SCAN
        </button>
      </div>
      <input type="text" id="scanInput" placeholder="Select user/dish first..." disabled
        class="mt-4 w-full bg-slate-900 p-3 text-lg text-center font-mono rounded-md border-2 border-slate-600 focus:border-pink-500 focus:ring-pink-500 focus:outline-none transition" />
    </section>

    <section class="grid md:grid-cols-2 gap-4">
      <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-md">
        <h2 class="text-base font-semibold text-slate-200 mb-3">üìà My Scans (Today)</h2>
        <p class="text-5xl font-mono font-extrabold text-pink-500" id="myScansCount">0</p>
        <p class="text-slate-400">for dish <span class="font-bold text-slate-200" id="myScansDish">--</span></p>
      </div>
       <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 shadow-md">
        <h2 class="text-base font-semibold text-slate-200 mb-3">üìä Daily Stats</h2>
        <div class="space-y-2 text-sm">
          <p class="flex justify-between"><span>Prepared Today:</span> <span id="preparedTodayCount" class="font-bold">0</span></p>
          <p class="flex justify-between"><span>Active Bowls:</span> <span id="activeCount" class="font-bold">0</span></p>
          <p class="flex justify-between"><span>Returned Today:</span> <span id="returnedTodayCount" class="font-bold">0</span></p>
        </div>
      </div>
    </section>
    
    <section class="bg-slate-800 border border-slate-700 rounded-lg p-4 mt-4 shadow-md">
      <h2 class="text-base font-semibold text-slate-200 mb-3">Live Prep Report (Today)</h2>
      <div class="overflow-y-auto max-h-60">
        <table class="w-full text-sm text-left">
          <thead class="sticky top-0 bg-slate-800">
            <tr class="border-b border-slate-600">
              <th class="p-2">Dish</th><th class="p-2">User</th><th class="p-2">Count</th>
            </tr>
          </thead>
          <tbody id="livePrepReportBody">
            <tr><td colspan="3" class="p-4 text-center text-slate-400">No bowls prepared today.</td></tr>
          </tbody>
        </table>
      </div>
    </section>

     <section class="bg-slate-800 border border-slate-700 rounded-lg p-4 mt-4 shadow-md">
      <h2 class="text-base font-semibold text-slate-200 mb-3">üõ†Ô∏è Data Management</h2>
      <div class="grid md:grid-cols-3 gap-4 mb-4">
        <button id="exportActiveBtn" class="p-2 rounded-lg text-sm font-bold bg-sky-600 hover:bg-sky-500">Export Active</button>
        <button id="exportReturnsBtn" class="p-2 rounded-lg text-sm font-bold bg-sky-600 hover:bg-sky-500">Export Returns</button>
        <button id="exportAllBtn" class="p-2 rounded-lg text-sm font-bold bg-pink-600 hover:bg-pink-500">Export All Data</button>
      </div>
      <p class="text-xs text-slate-400 mb-3">Last Firebase Sync: <span id="lastSyncInfo">N/A</span></p>
      
      <div class="border-t border-slate-700 pt-4">
        <h3 class="text-sm font-semibold text-amber-400 mb-2">Patch Customer Data</h3>
        <textarea id="jsonInput" rows="3" placeholder='Paste JSON array here, e.g., [{"bowl_id": "...", "customer_name": "...", "company": "..."}]' class="w-full bg-slate-900 p-2 rounded-md text-xs font-mono border border-slate-600"></textarea>
        <button id="patchJsonBtn" class="mt-2 w-full p-2 text-sm font-bold rounded-lg bg-amber-600 hover:bg-amber-500">Apply JSON Patch</button>
        <div id="patchResultContainer" style="display:none;" class="mt-2 p-2 rounded text-xs"></div>
      </div>

       <div class="border-t border-slate-700 pt-4 mt-4">
         <h3 class="text-sm font-semibold text-red-400 mb-2">Danger Zone</h3>
         <button id="resetPreparedBtn" class="w-full p-2 text-sm font-bold rounded-lg bg-red-800 hover:bg-red-700">Reset Today's Prep Data</button>
       </div>
    </section>
  </div>
</body>
</html>
